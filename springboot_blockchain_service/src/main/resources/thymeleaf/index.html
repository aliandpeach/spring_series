<!DOCTYPE html>
<html lang="cn" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <style>
        .bold {
            font-weight: bold;
        }
    </style>
    <script type="text/javascript" th:src="@{/jquery/jquery-1.8.0.min.js}" ></script>
</head>
<body>
    <div>
        <button th:disabled="${run}" id="start">开始</button>
        <button th:disabled="${!run}" id="stop">停止</button>
        <span id="_status" class="bold" th:text="${status}"></span>
    </div>
    <div>
        <input style="width: 570px" th:disabled="${run}" id="minKey" th:value="${minKey}"/>
        <input style="width: 570px" th:disabled="${run}" id="maxKey" th:value="${maxKey}"/>
    </div>
    <div>
        <a th:href="@{/logs/record_info.log}" target="_blank">地址</a>
    </div>
    <div>
        <a th:href="@{/logs/hex_key_info.log}" target="_blank">16进制地址</a>
    </div>
    <div>
        <a th:href="@{/logs/watched_info.log}" target="_blank">结果</a>
    </div>
    <div>
        <a th:href="@{/logs/status_info.log}" target="_blank">状态</a>
    </div>
    <div>
        <a th:href="@{/logs/error.log}" target="_blank">错误</a>
    </div>
    <div>
        <a th:href="@{/block/chain/the/min}" target="_blank">运行</a>
    </div>
    <!--<div>
        <a th:href="@{/block/chain/the/range}" target="_blank">已运行数量</a>
    </div>-->
    <div>
        <button id="calc">数量计算</button>
        <span id="_calc_result" class="bold"></span>
    </div>
    <div>
        <input style="width: 570px" id="range_start" />
        <input style="width: 570px" id="range_end" />
    </div>
</body>
<script th:inline="javascript">

    $(function () {
        $("#start").click(function () {
            todo(this.id);
        });
        $("#stop").click(function () {
            todo(this.id);
        });
        $("#calc").unbind("click").bind("click", function () {
            calc();
        });
    });

    function todo(status) {
        $.ajax({
            type: "post",
            contentType: "application/json",
            url: "/block/chain/" + status,
            data: '{"min": "' + $("#minKey").val() + '", "max": "' + $("#maxKey").val() + '"}',
            async: true,
            success: function (result) {
                var _status = result.status;
                $("#_status").html(_status);
                window.location.href = "/";
            }
        });
    }
    function calc() {
        $.ajax({
            type: "get",
            contentType: "application/x-www-form-urlencoded",
            url: "/block/chain/the/calc",
            data: 'start=' + $("#range_start").val() + '&end=' + $("#range_end").val(),
            async: true,
            success: function (result) {
                var _range = result.range;
                $("#_calc_result").html(_range);
            }
        });
    }

    function ajax(url, type) {
        var xhr = new XMLHttpRequest();
        var result;

        var p = new Promise(function (resolve, reject) {
            xhr.open(type, url, true);
            xhr.onload = function (e) {
                if (this.status === 200) {
                    result = JSON.parse(this.responseText);
                    resolve(result);
                }
            };
            xhr.onerror = function (e) {
                reject(e);
            };
            xhr.send();
        });
        return p;
    }
</script>
</html>